[
    {
        "id": "5cf9b3d9818214c9",
        "type": "tab",
        "label": "ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãƒã‚¤ã‚¯ã§ãƒã‚¤ã‚¯ãƒ©",
        "disabled": false,
        "info": "# ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãƒã‚¤ã‚¯ã§ãƒã‚¤ã‚¯ãƒ©\n\nBLEãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãƒã‚¤ã‚¯ã®å›è»¢æ•°(cadence)ã§Minecraft Education Editionã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’æ“ä½œã—ã¾ã™ã€‚\n\n## ä½¿ã„æ–¹\n\n1. ãƒã‚¤ã‚¯ã®é›»æºã‚’ON\n2. Minecraftã‚’èµ·å‹•ã—ã¦ãƒ¯ãƒ¼ãƒ«ãƒ‰ã«å…¥ã‚‹\n3. [é–‹å§‹]ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\n4. ãƒã‚¤ã‚¯ã‚’æ¼•ã\n\n### ãƒ‡ãƒãƒƒã‚°\n\n- **BLEåˆ‡æ–­**: [BLEåˆ‡æ–­]ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\n  - BLEæ¥ç¶šã‚’åˆ‡æ–­ï¼ˆä¿¡å·ãŒæ­¢ã¾ã‚‹ï¼‰\n  - å†é–‹ã¯[é–‹å§‹]ãƒœã‚¿ãƒ³ã§å†æ¥ç¶š\n\n## é€Ÿåº¦åˆ¶å¾¡\n\n| cadence (rpm) | Minecraftæ“ä½œ | ã‚­ãƒ¼ |\n|---|---|---|\n| > 55 | ãƒ€ãƒƒã‚·ãƒ¥ | W + Control |\n| 1 ~ 55 | é€šå¸¸å‰é€² | W |\n| < 1 | åœæ­¢ | (ã‚­ãƒ¼ã‚’é›¢ã™) |\n\n## Bluetoothä»•æ§˜\n\n### Service UUID: 1826 (FTMS)\n- **æ­£å¼åç§°**: Fitness Machine Service\n- **è¦æ ¼**: Bluetooth SIGæ¨™æº–ã‚µãƒ¼ãƒ“ã‚¹\n- **ä»•æ§˜æ›¸**: https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/\n- **èª¬æ˜**: ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãƒã‚·ãƒ³ï¼ˆãƒˆãƒ¬ãƒƒãƒ‰ãƒŸãƒ«ã€ãƒã‚¤ã‚¯ç­‰ï¼‰ç”¨ã®æ¨™æº–BLEã‚µãƒ¼ãƒ“ã‚¹\n- **å€‹ä½“ä¾å­˜**: ãªã—ï¼ˆå…¨ã¦ã®FTMSå¯¾å¿œæ©Ÿå™¨ã§å…±é€šï¼‰\n\n### Characteristic UUID: 2ad2 (Indoor Bike Data)\n- **æ­£å¼åç§°**: Indoor Bike Data\n- **ãƒ‡ãƒ¼ã‚¿å½¢å¼**: 18ãƒã‚¤ãƒˆï¼ˆãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼‰\n- **æ›´æ–°é »åº¦**: ç´„1ç§’ã”ã¨\n- **å«ã¾ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿**: speed, cadence, distance, power, energy, time\n- **ä»•æ§˜æ›¸**: https://www.bluetooth.com/specifications/specs/gatt-specification-supplement/\n\n## å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\n\n- node-red-contrib-noble-bluetooth\n- robotjs",
        "env": []
    },
    {
        "id": "1cdf1482a9aae136",
        "type": "inject",
        "z": "5cf9b3d9818214c9",
        "name": "é–‹å§‹",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "start",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "ed01f862488b4593"
            ]
        ]
    },
    {
        "id": "ed01f862488b4593",
        "type": "BLE scanner",
        "z": "5cf9b3d9818214c9",
        "name": "FTMSãƒã‚¤ã‚¯ã‚’ã‚¹ã‚­ãƒ£ãƒ³ (UUID:1826)",
        "services": "1826",
        "servicesType": "str",
        "continuous": false,
        "x": 350,
        "y": 60,
        "wires": [
            [
                "28481cc038050467"
            ]
        ]
    },
    {
        "id": "28481cc038050467",
        "type": "BLE device",
        "z": "5cf9b3d9818214c9",
        "name": "ãƒã‚¤ã‚¯ã«æ¥ç¶š",
        "x": 600,
        "y": 60,
        "wires": [
            [
                "26df239b799ebcbc"
            ]
        ]
    },
    {
        "id": "26df239b799ebcbc",
        "type": "BLE in",
        "z": "5cf9b3d9818214c9",
        "topic": "subscribe",
        "characteristic": "2ad2",
        "name": "ãƒã‚¤ã‚¯ãƒ‡ãƒ¼ã‚¿å—ä¿¡ (UUID:2ad2)",
        "x": 330,
        "y": 160,
        "wires": [
            [
                "51ddf084c748a96f"
            ]
        ]
    },
    {
        "id": "51ddf084c748a96f",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "FTMSãƒ‡ãƒ¼ã‚¿è§£æ",
        "func": "/**\n * FTMS Indoor Bike Dataãƒ‘ãƒ¼ã‚µãƒ¼\n * \n * ã€ä»•æ§˜ã€‘\n * - Service UUID: 1826 (Fitness Machine Service)\n * - Characteristic UUID: 2ad2 (Indoor Bike Data)\n * - ä»•æ§˜æ›¸: https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/\n * \n * ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘\n * - 18ãƒã‚¤ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿\n * - ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³å½¢å¼\n * - æ›´æ–°é »åº¦: ç´„1ç§’ã”ã¨\n * \n * ã€ãƒã‚¤ãƒˆãƒãƒƒãƒ—ã€‘\n * Byte 0-1:   Flags (0x0000 = å…¨ãƒ‡ãƒ¼ã‚¿æœ‰åŠ¹)\n * Byte 2-3:   Instantaneous Speed (0.01 km/h å˜ä½)\n * Byte 4-5:   Instantaneous Cadence (0.5 rpm å˜ä½) â† Minecraftåˆ¶å¾¡ã«ä½¿ç”¨\n * Byte 6-8:   Total Distance (1 m å˜ä½)\n * Byte 9-10:  Instantaneous Power (1 watt å˜ä½)\n * Byte 11-12: Total Energy (1 kcal å˜ä½)\n * Byte 13-14: Energy Per Hour (1 kcal/hour å˜ä½)\n * Byte 15:    Energy Per Minute (1 kcal/minute å˜ä½)\n * Byte 16-17: Elapsed Time (1 second å˜ä½)\n * \n * ã€æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã€‘\n * - speed: é€Ÿåº¦ (km/h)\n * - cadence: å›è»¢æ•° (rpm) â† Minecraftã®é€Ÿåº¦åˆ¶å¾¡ã«ä½¿ç”¨\n * - distance: è·é›¢ (m)\n * - power: ãƒ‘ãƒ¯ãƒ¼ (watts)\n * - totalEnergy: ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal)\n * - energyPerHour: æ™‚é–“ã‚ãŸã‚Šæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal/hour)\n * - energyPerMinute: åˆ†ã‚ãŸã‚Šæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal/minute)\n * - elapsedTime: çµŒéæ™‚é–“ (seconds)\n */\n\n// ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª\nif (msg.payload) {\n    const data = msg.payload;\n    \n    // ãƒ‡ãƒ¼ã‚¿é•·ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€ä½18ãƒã‚¤ãƒˆå¿…è¦ï¼‰\n    if (data.length < 18) {\n        node.error(\"ãƒ‡ãƒ¼ã‚¿ãŒçŸ­ã™ãã¾ã™: \" + data.length + \"ãƒã‚¤ãƒˆ\");\n        return null;\n    }\n    \n    // ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³èª­ã¿å–ã‚Šé–¢æ•°\n    const readUInt16LE = (offset) => data[offset] | (data[offset + 1] << 8);\n    const readUInt24LE = (offset) => data[offset] | (data[offset + 1] << 8) | (data[offset + 2] << 16);\n    \n    // ãƒ‡ãƒ¼ã‚¿è§£æï¼ˆFTMSãƒã‚¤ãƒˆãƒãƒƒãƒ—ã«å¾“ã†ï¼‰\n    const flags = readUInt16LE(0);              // ãƒ•ãƒ©ã‚°ï¼ˆæœªä½¿ç”¨ï¼‰\n    const speed = readUInt16LE(2) * 0.01;       // é€Ÿåº¦ (0.01 km/hå˜ä½)\n    const cadence = readUInt16LE(4) * 0.5;      // å›è»¢æ•° (0.5 rpmå˜ä½)\n    const distance = readUInt24LE(6);           // è·é›¢ (m)\n    const power = readUInt16LE(9);              // ãƒ‘ãƒ¯ãƒ¼ (watts)\n    const totalEnergy = readUInt16LE(11);       // ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal)\n    const energyPerHour = readUInt16LE(13);     // æ™‚é–“ã‚ãŸã‚Šæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal/hour)\n    const energyPerMinute = data[15];           // åˆ†ã‚ãŸã‚Šæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal/minute)\n    const elapsedTime = readUInt16LE(16);       // çµŒéæ™‚é–“ (seconds)\n\n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º\n    node.status({ fill: \"green\", shape: \"dot\", text: \"ãƒ‡ãƒ¼ã‚¿å—ä¿¡ä¸­\" });\n\n    // è§£æçµæœã‚’è¿”ã™\n    return {\n        topic: 'ftmsData',\n        payload: {\n            speed: speed,\n            cadence: cadence,\n            distance: distance,\n            power: power,\n            totalEnergy: totalEnergy,\n            energyPerHour: energyPerHour,\n            energyPerMinute: energyPerMinute,\n            elapsedTime: elapsedTime\n        }\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 160,
        "wires": [
            [
                "gate_node"
            ]
        ]
    },
    {
        "id": "gate_node",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "ã‚²ãƒ¼ãƒˆ",
        "func": "// flowå¤‰æ•°ã§ON/OFFåˆ¶å¾¡\nconst gateOpen = flow.get('gateOpen');\n\n// åˆå›ã¯trueã¨ã—ã¦æ‰±ã†\nif (gateOpen === undefined || gateOpen === true) {\n    return msg;\n}\n\n// ã‚²ãƒ¼ãƒˆãŒé–‰ã˜ã¦ã„ã‚‹å ´åˆã¯ç ´æ£„\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 300,
        "wires": [
            [
                "27142d08d5e78ff2"
            ]
        ]
    },
    {
        "id": "27142d08d5e78ff2",
        "type": "switch",
        "z": "5cf9b3d9818214c9",
        "name": "å›è»¢æ•°ã§åˆ†å²",
        "property": "payload.cadence",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "55",
                "vt": "num"
            },
            {
                "t": "btwn",
                "v": "1",
                "vt": "num",
                "v2": "55",
                "v2t": "num"
            },
            {
                "t": "lt",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 440,
        "y": 300,
        "wires": [
            [
                "18d0aae9a42eb03a"
            ],
            [
                "cd4a2356763338e5"
            ],
            [
                "3435ea82b0f823db"
            ]
        ]
    },
    {
        "id": "18d0aae9a42eb03a",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "ãƒ€ãƒƒã‚·ãƒ¥",
        "func": "/**\n * ãƒ€ãƒƒã‚·ãƒ¥åˆ¶å¾¡\n * \n * ã€å‹•ä½œã€‘\n * - Wã‚­ãƒ¼: æŠ¼ã™ï¼ˆå‰é€²ï¼‰\n * - Controlã‚­ãƒ¼: æŠ¼ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ï¼‰\n */\n\nconst oldTimer = context.get('statusTimer');\nif (oldTimer) clearTimeout(oldTimer);\n\n// Wã‚­ãƒ¼ã‚’æŠ¼ã™ï¼ˆå‰é€²ï¼‰\nrobotjs.keyToggle('w', 'down');\n\n// Controlã‚­ãƒ¼ã‚’æŠ¼ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ï¼‰\nrobotjs.keyToggle('control', 'down');\n\n// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆç·‘è‰²ã€ç¾åœ¨ã®cadenceè¡¨ç¤ºï¼‰\nnode.status({\n    fill: \"green\", \n    shape: \"dot\", \n    text: `ãƒ€ãƒƒã‚·ãƒ¥ ${msg.payload.cadence.toFixed(1)} rpm`\n});\n\n// 1ç§’å¾Œã«æ¶ˆã™ï¼ˆæ¬¡ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼‰\nconst timer = setTimeout(() => {\n    node.status({});\n}, 1000);\ncontext.set('statusTimer', timer);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "robotjs",
                "module": "robotjs"
            }
        ],
        "x": 620,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "cd4a2356763338e5",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "å‰é€²",
        "func": "/**\n * å‰é€²åˆ¶å¾¡\n * \n * ã€å‹•ä½œã€‘\n * - Wã‚­ãƒ¼: æŠ¼ã™ï¼ˆå‰é€²ï¼‰\n * - Controlã‚­ãƒ¼: é›¢ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãªã—ï¼‰\n */\n\nconst oldTimer = context.get('statusTimer');\nif (oldTimer) clearTimeout(oldTimer);\n\n// Wã‚­ãƒ¼ã‚’æŠ¼ã™ï¼ˆå‰é€²ï¼‰\nrobotjs.keyToggle('w', 'down');\n\n// Controlã‚­ãƒ¼ã‚’é›¢ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãªã—ï¼‰\nrobotjs.keyToggle('control', 'up');\n\n// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆé»„è‰²ã€ç¾åœ¨ã®cadenceè¡¨ç¤ºï¼‰\nnode.status({\n    fill: \"yellow\", \n    shape: \"dot\", \n    text: `å‰é€² ${msg.payload.cadence.toFixed(1)} rpm`\n});\n\n// 1ç§’å¾Œã«æ¶ˆã™ï¼ˆæ¬¡ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼‰\nconst timer = setTimeout(() => {\n    node.status({});\n}, 1000);\ncontext.set('statusTimer', timer);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "robotjs",
                "module": "robotjs"
            }
        ],
        "x": 610,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "3435ea82b0f823db",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "åœæ­¢",
        "func": "/**\n * åœæ­¢\n * \n * ã€å‹•ä½œã€‘\n * - Wã‚­ãƒ¼: é›¢ã™ï¼ˆå‰é€²åœæ­¢ï¼‰\n * - Controlã‚­ãƒ¼: é›¢ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥åœæ­¢ï¼‰\n */\n\nconst oldTimer = context.get('statusTimer');\nif (oldTimer) clearTimeout(oldTimer);\n\n// Wã‚­ãƒ¼ã‚’é›¢ã™ï¼ˆå‰é€²åœæ­¢ï¼‰\nrobotjs.keyToggle('w', 'up');\n\n// Controlã‚­ãƒ¼ã‚’é›¢ã™ï¼ˆãƒ€ãƒƒã‚·ãƒ¥åœæ­¢ï¼‰\nrobotjs.keyToggle('control', 'up');\n\n// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆã‚°ãƒ¬ãƒ¼ã€åœæ­¢è¡¨ç¤ºï¼‰\nnode.status({\n    fill: \"grey\", \n    shape: \"ring\", \n    text: \"åœæ­¢\"\n});\n\n// 1ç§’å¾Œã«æ¶ˆã™ï¼ˆæ¬¡ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼‰\nconst timer = setTimeout(() => {\n    node.status({});\n}, 1000);\ncontext.set('statusTimer', timer);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "// Node-REDçµ‚äº†æ™‚ã«è‡ªå‹•å®Ÿè¡Œ\nrobotjs.keyToggle('w', 'up');\nrobotjs.keyToggle('control', 'up');\nnode.warn('ğŸ›‘ çµ‚äº†æ™‚ã‚­ãƒ¼ãƒªã‚»ãƒƒãƒˆå®Œäº†');",
        "libs": [
            {
                "var": "robotjs",
                "module": "robotjs"
            }
        ],
        "x": 610,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "disconnect_button",
        "type": "inject",
        "z": "5cf9b3d9818214c9",
        "name": "åœæ­¢",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 130,
        "y": 360,
        "wires": [
            [
                "gate_close"
            ]
        ]
    },
    {
        "id": "gate_close",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "ã‚²ãƒ¼ãƒˆé–‰",
        "func": "// ã‚²ãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹\nflow.set('gateOpen', false);\nnode.warn('â¸ï¸ ã‚²ãƒ¼ãƒˆã‚’é–‰ã˜ã¾ã—ãŸï¼ˆãƒ‡ãƒ¼ã‚¿åœæ­¢ï¼‰');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "reconnect_button",
        "type": "inject",
        "z": "5cf9b3d9818214c9",
        "name": "å†é–‹",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 130,
        "y": 420,
        "wires": [
            [
                "gate_open"
            ]
        ]
    },
    {
        "id": "gate_open",
        "type": "function",
        "z": "5cf9b3d9818214c9",
        "name": "ã‚²ãƒ¼ãƒˆé–‹",
        "func": "// ã‚²ãƒ¼ãƒˆã‚’é–‹ã\nflow.set('gateOpen', true);\nnode.warn('â–¶ï¸ ã‚²ãƒ¼ãƒˆã‚’é–‹ãã¾ã—ãŸï¼ˆãƒ‡ãƒ¼ã‚¿å†é–‹ï¼‰');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 420,
        "wires": [
            []
        ]
    }
]